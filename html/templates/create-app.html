<h1 align="center">新規作成</h1>

<form style="border-radius: 2em; padding: 5em; margin-top: 10vh; margin-left: 30vw; margin-right: 30vw; border: 1px solid #000;">
  <div>
    <b>アプリ名を入力してください。</b>
    <p align="center"><input type="text" id="create-app-form-name"></p>
  </div>
  <div>
    <b>保存するフォルダの場所を指定してください。</b><br>
    ※　指定したフォルダ内に編集用の「edit」フォルダとアップロード用の「out」フォルダが作成されます。　※
    <p align="center">
      <button type="button" onclick="selectFolder()">フォルダを選択</button>
      <input type="text" id="create-app-form-path">
    </p>
  </div>
  <div>
    <b>オプションを選択してください。</b>
    <p align="center">
      <select id="create-app-form-option"></select>
    </p>
  </div>
  <p align="center"><button type="button" onclick="send();">決定</button></p>
</form>

<script>
  for(const option of templateOptions){
    $("#create-app-form-option").append('<option value="' + option + '">' + option + '</option>');
  }
  function send(){
    const alertTexts = [];
    if($("#create-app-form-name").val() == ""){
      alertTexts.push("・アプリ名を選択してください。");
    }
    if($("#create-app-form-path").val() == ""){
      alertTexts.push("・フォルダを選択してください。");
    }
    if(alertTexts.length == 0){
      const params = {};
      for(const key of ["name", "option", "path", "port"]){
        params[key] = $("#create-app-form-" + key).val();
      }
      $.post("/create-app", params, function(data){
        if(data.status == "success"){
          confirmToOpenGas();
        } else {
          alert(data.message);
        }
      });
    } else {
      alert(alertTexts.join("\n\n"));
    }
  }

  function selectFolder(path=""){
    $.post("/search-path-of-app", {path}, function(data){
      console.log(data);
    });
  }
  
  function selectedFolder(path=""){}
  
  function confirmToOpenGas(){
    const result = confirm('外部サイト(GAS)を利用してあなたのGASを保存するフォルダを決めますか？')
    if(result){
      location.href='https://script.google.com/macros/s/AKfycbwslh0A0p2eQwHFI7m1nPuSbRZnd4goayZyxoVb_p4hAyDuSwFeC2lgBZoxYLRXP87VZw/exec?port=' + port + '&appName=' + $("#create-app-form-name").val();
    } else{
      alert('当アプリをご利用いただけません。終了いたします。');
      selectedTab('stop');
    }
  };
</script>